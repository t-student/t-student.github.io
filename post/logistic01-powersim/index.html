<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.38.1" />
  <meta name="author" content="Mark Jones">

  
  
  
  
    
      
    
  
  <meta name="description" content="If you have multiple treatment options that lead to different outcomes, you will only be able to detect a difference in the average outcome under conditions where there is sufficient statistical power to do so. Statistical power is the probability that we detect an effect when there really is an effect to be detected. As statistical power increases the probability of making a Type II error (concluding there is no effect when, in fact, there is one) decreases.">

  
  <link rel="alternate" hreflang="en-us" href="https://t-student.github.io/post/logistic01-powersim/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-112871477-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="https://t-student.github.io/index.xml" type="application/rss+xml" title="t-student">
  <link rel="feed" href="https://t-student.github.io/index.xml" type="application/rss+xml" title="t-student">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://t-student.github.io/post/logistic01-powersim/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="t-student">
  <meta property="og:url" content="https://t-student.github.io/post/logistic01-powersim/">
  <meta property="og:title" content="Logistic Regression - Power Analysis | t-student">
  <meta property="og:description" content="If you have multiple treatment options that lead to different outcomes, you will only be able to detect a difference in the average outcome under conditions where there is sufficient statistical power to do so. Statistical power is the probability that we detect an effect when there really is an effect to be detected. As statistical power increases the probability of making a Type II error (concluding there is no effect when, in fact, there is one) decreases.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-02-16T00:00:00&#43;11:00">
  
  <meta property="article:modified_time" content="2018-02-16T00:00:00&#43;11:00">
  

  

  <title>Logistic Regression - Power Analysis | t-student</title>

  
</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">t-student</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">Logistic Regression - Power Analysis</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-02-16 00:00:00 &#43;1100 AEDT" itemprop="datePublished dateModified">
      Feb 16, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mark Jones">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Logistic%20Regression%20-%20Power%20Analysis&amp;url=https%3a%2f%2ft-student.github.io%2fpost%2flogistic01-powersim%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2ft-student.github.io%2fpost%2flogistic01-powersim%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ft-student.github.io%2fpost%2flogistic01-powersim%2f&amp;title=Logistic%20Regression%20-%20Power%20Analysis"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2ft-student.github.io%2fpost%2flogistic01-powersim%2f&amp;title=Logistic%20Regression%20-%20Power%20Analysis"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Logistic%20Regression%20-%20Power%20Analysis&amp;body=https%3a%2f%2ft-student.github.io%2fpost%2flogistic01-powersim%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        

<p>If you have multiple treatment options that lead to different outcomes, you will only be able to detect a difference in the average outcome under conditions where there is sufficient <em>statistical power</em> to do so. <em>Statistical power</em> is the probability that we detect an effect when there really is an effect to be detected. As statistical power increases the probability of making a Type II error (concluding there is no effect when, in fact, there is one) decreases.</p>

<p>Statistical power is affected by the size of the effect, the statistical significance criteria (typically 0.05) and the size of the sample. It is possible to miss a real effect simply by not taking a large enough sample. Power analyses help us by allowing us to explore the experimental conditions for a range of sample sizes.</p>

<p>In this post we look at how power varies in a logistic regression setting. First we compare treatment groups directly and then we compare treatment groups stratified by a characteristic of the mother that is also associated with the response of interest - e.g. a genetic disposition for a disease.</p>

<h2 id="rct-steroidal-treatments-for-reducing-the-risk-of-having-an-ashthmatic-child">RCT Steroidal Treatments for Reducing the Risk of having an Ashthmatic Child.</h2>

<p>Consider a steroidal intervention that influences the likelihood of having an ashmatic child. Assume a pilot study suggests the observed proportion of asthmatic kids in the control arm is 17.4% and in the treatment arm is 10%. This implies a relative risk (RR) of 0.575 - the probability of a kid having ashmatic in the treatment arm is 0.58 times that in the control arm.</p>

<p>Robert Grant gives us a way to convert odds-ratios (OR) to RR <a href="https://robertgrantstats.wordpress.com/2014/01/27/how-to-convert-odds-ratios-to-relative-risks/" target="_blank">here</a>, specifically $RR = \frac{OR}{1 – p + (p \times OR)}$. Turning this formula around we find the unadjusted odds-ratio is about 0.5329 - the odds of an &ldquo;average&rdquo; parent having an asthmatic kid in the treatment arm are around 0.53 times the odds of an equivalent parent having an asthmatic kid in the control arm.</p>

<p>Let&rsquo;s say we want to work out a sample size for a formal parallel arm RCT. We suspect that we will only be able to get 650 people and the odds of an event in the intervention group are about half the odds of an event in the control group. What sort of power do we expect to obtain with this sample?</p>

<h3 id="method">Method</h3>

<p>Assume:</p>

<ol>
<li>Balanced groups (randomly selected) of 325 mothers per arm</li>
<li>Proportion having asthmatic kid in control is 0.174</li>
<li>The odds ratio associated with the steroidal treatment is 0.5329</li>
<li>Adopt a linear predictor solely based on group membership</li>
<li>Simulate a sample of kids by:

<ol>
<li>Computing probability of asthma based on the exponentiated logits.</li>
<li>Draw from binomial distribution parameterised as $Bin(n, p)$ where n is the (total) sample size and p the probability of ashmatic child.</li>
</ol></li>
<li>Fit a GLM with specification y ~ grp using the sample data and from this predict the probability for the control and treatment groups along with the difference in probability and estimated OR</li>
<li>Bootstrap (299 replicates) to get the 0.025 and 0.975 quantiles of the difference</li>
<li>Repeat the above 999 times</li>
</ol>

<p>The above can be decomposed into separate functions - one to generate a simulated dataset, one to retrieve the bootstrap statistics of interest and one to contain these two, which we will call from a loop with 999 iterations.</p>

<h3 id="data-generation">Data Generation</h3>

<p>This first function creates a dataset representative of the data we might observe in our real experiment. Each time the method is called a new data set will be created. Ignore the single nucleotide polymorphisms (<a href="https://en.wikipedia.org/wiki/Single-nucleotide_polymorphism" target="_blank">SNP</a>) variables for now.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">get.data <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(n.arm <span style="color:#f92672">=</span> <span style="color:#ae81ff">325</span>, 
                     p.ctl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.174</span>,
                     or.trt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5329</span>,
                     or.snp <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, 
                     include.snp <span style="color:#f92672">=</span> F){

  <span style="color:#75715e"># We create a linear predictor from which we generate data.</span>
  <span style="color:#75715e"># y ~ b0 + b1 * grp</span>
  <span style="color:#75715e"># or </span>
  <span style="color:#75715e"># y ~ b0 + b1 * grp + b2 * snp</span>
  <span style="color:#75715e"># The response of interest is asthma, denoted as 1/0 (yes/no).</span>
  <span style="color:#75715e"># Assume proportion in the ctl group with asthma is 0.174.</span>
  <span style="color:#75715e"># So, assuming the control group is the referant, </span>
  <span style="color:#75715e"># the baseline odds are:</span>
  <span style="color:#75715e"># p / (1-p) = 0.210653753</span>
  <span style="color:#75715e"># Taking the log of this gives us the intercept term</span>
  <span style="color:#75715e"># log(0.21) = -1.55754</span>
  <span style="color:#75715e"># The OR for intervention is 0.5329:</span>
  <span style="color:#75715e"># log(0.5329) = -0.6294215</span>

  <span style="color:#75715e"># Baseline odds:</span>
  b0 <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">log</span>(p.ctl <span style="color:#f92672">/</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p.ctl))
  <span style="color:#75715e"># b1 is the coef for trt effect</span>
  b1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">log</span>(or.trt)
   
  <span style="color:#75715e"># Group membership (0 = ctl, 1 = trt arm)</span>
  grp <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">c</span>(<span style="color:#66d9ef">rep</span>(<span style="color:#ae81ff">0</span>, n.arm), <span style="color:#66d9ef">rep</span>(<span style="color:#ae81ff">1</span>, n.arm))
  
  snp <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
  
  <span style="color:#66d9ef">if</span> (include.snp){
    b2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">log</span>(or.snp)

    <span style="color:#75715e"># Genetic disposition to asthmatic kids in 86% of the population.</span>
    <span style="color:#75715e"># The 86% is arbitrary and made up just for the example.</span>
    snp <span style="color:#f92672">&lt;-</span> rbinom(n<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>n.arm, <span style="color:#ae81ff">1</span>, prob <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.86</span>)

    <span style="color:#75715e"># Linear predictor a combination of group and genetic disposition</span>
    <span style="color:#75715e"># for having an asthmatic kid</span>
    logit.y <span style="color:#f92672">&lt;-</span> b0 <span style="color:#f92672">+</span> b1 <span style="color:#f92672">*</span> grp <span style="color:#f92672">+</span> b2 <span style="color:#f92672">*</span> snp
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#75715e"># Linear predictor for the simple group comparison</span>
    logit.y <span style="color:#f92672">&lt;-</span> b0 <span style="color:#f92672">+</span> b1 <span style="color:#f92672">*</span> grp 
  }

  <span style="color:#75715e"># Gives us a randomly generated sequence of asthmatic kids</span>
  <span style="color:#75715e"># based on individual probability of event.</span>
  p.y <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">exp</span>(logit.y)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">exp</span>(logit.y))
  y <span style="color:#f92672">&lt;-</span> rbinom(n<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>n.arm, <span style="color:#ae81ff">1</span>, prob <span style="color:#f92672">=</span> p.y)
  
  <span style="color:#75715e"># Our pseudo sample.</span>
  df.dat <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#66d9ef">length</span>(grp), 
                       grp <span style="color:#f92672">=</span> grp, 
                       snp <span style="color:#f92672">=</span> snp,
                       p.y <span style="color:#f92672">=</span> p.y,
                       y <span style="color:#f92672">=</span> y)
  
  <span style="color:#66d9ef">return</span>(df.dat)
}</code></pre></div>

<h3 id="bootstrap-function">Bootstrap Function</h3>

<p>This function is used by the call to the <code>boot</code> function - more context can be found in the R help section for <code>boot</code>. Given a dataset and indices the function fits a GLM using a supplied formula/specification and returns estimates and predictions from the fitted model.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Boot strapped logistic giving diff between proportions</span>
boot.glm <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(df.b, 
                     indices, 
                     myformula <span style="color:#f92672">=</span> myformula,
                     df.new <span style="color:#f92672">=</span> df.new) {
  
  <span style="color:#75715e"># GLM Logistic</span>
  d <span style="color:#f92672">&lt;-</span> df.b[indices, ]
  m <span style="color:#f92672">&lt;-</span> glm(myformula, family<span style="color:#f92672">=</span>binomial, data <span style="color:#f92672">=</span> d)
  
  prop <span style="color:#f92672">&lt;-</span> predict(m, newdata <span style="color:#f92672">=</span> df.new, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;response&#34;</span>)
  p.ctl <span style="color:#f92672">&lt;-</span> prop[<span style="color:#ae81ff">1</span>]
  p.trt <span style="color:#f92672">&lt;-</span> prop[<span style="color:#ae81ff">2</span>]
  p.diff <span style="color:#f92672">&lt;-</span> p.ctl <span style="color:#f92672">-</span> p.trt
  est.or <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">exp</span>(coef(m))[<span style="color:#ae81ff">2</span>]

  <span style="color:#75715e"># s &lt;- summary(m)</span>
  <span style="color:#75715e"># est.or.pval &lt;- s$coefficients[&#34;stageint.2&#34;, &#34;Pr(&gt;|z|)&#34;]</span>

  <span style="color:#66d9ef">as.numeric</span>(<span style="color:#66d9ef">c</span>(p.ctl <span style="color:#f92672">=</span> p.ctl,
               p.trt <span style="color:#f92672">=</span> p.trt,
               p.diff <span style="color:#f92672">=</span> p.diff,
               est.or <span style="color:#f92672">=</span> est.or))
}</code></pre></div>

<h3 id="simulation-function">Simulation Function</h3>

<p>This function encapsulates the code required to perform a single iteration of the simulation. It calls on the <code>get.data</code> described earlier then bootstraps a GLM model (with a pre-specified formula) to obtain parameter estimates and confidence intervals and dumps them into a data.frame that is returned to the calling function.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sim.glm <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(x,
                    n.arm <span style="color:#f92672">=</span> <span style="color:#ae81ff">325</span>, 
                    p.ctl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.174</span>,
                    or.trt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5329</span>,
                    or.snp <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, 
                    boot.reps <span style="color:#f92672">=</span> <span style="color:#ae81ff">299</span>,
                    include.snp <span style="color:#f92672">=</span> F){
  
  
  df.dat <span style="color:#f92672">&lt;-</span> get.data(n.arm <span style="color:#f92672">=</span> n.arm, 
                     p.ctl <span style="color:#f92672">=</span> p.ctl,
                     or.trt <span style="color:#f92672">=</span> or.trt,
                     or.snp <span style="color:#f92672">=</span> or.snp, 
                     include.snp <span style="color:#f92672">=</span> include.snp)


  <span style="color:#75715e"># Specify the required formula to fit</span>
  <span style="color:#66d9ef">if</span>(include.snp){
    myformula <span style="color:#f92672">=</span> y <span style="color:#f92672">~</span> grp <span style="color:#f92672">+</span> snp
    df.new <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(grp <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), snp <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
  }<span style="color:#66d9ef">else</span>{
    myformula <span style="color:#f92672">=</span> y <span style="color:#f92672">~</span> grp
    df.new <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(grp <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))
  }

  <span style="color:#75715e"># Bootstrap</span>
  bb <span style="color:#f92672">&lt;-</span> boot<span style="color:#f92672">::</span>boot(df.dat, 
                   statistic<span style="color:#f92672">=</span>boot.glm, 
                   R<span style="color:#f92672">=</span>boot.reps, 
                   myformula <span style="color:#f92672">=</span> myformula, 
                   df.new <span style="color:#f92672">=</span> df.new)
  

  <span style="color:#75715e"># First look at differences</span>
  glm.prob.diff.est <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">mean</span>(bb<span style="color:#f92672">$</span><span style="color:#66d9ef">t</span>[,<span style="color:#ae81ff">3</span>])
  glm.prob.diff.lwr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.numeric</span>(quantile(bb<span style="color:#f92672">$</span><span style="color:#66d9ef">t</span>[,<span style="color:#ae81ff">3</span>], probs <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025</span>))
  glm.prob.diff.upr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.numeric</span>(quantile(bb<span style="color:#f92672">$</span><span style="color:#66d9ef">t</span>[,<span style="color:#ae81ff">3</span>], probs <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.975</span>))
  glm.prob.sig.diff <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">ifelse</span>(glm.prob.diff.est <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span> glm.prob.diff.lwr <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
  
  <span style="color:#75715e"># Now look at OR</span>
  glm.or.est <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">mean</span>(bb<span style="color:#f92672">$</span><span style="color:#66d9ef">t</span>[,<span style="color:#ae81ff">4</span>])

  
  <span style="color:#75715e"># Note that for the snp tests, the probability of having an asthmatic kid</span>
  <span style="color:#75715e"># is conditional on presence of snp.</span>
  <span style="color:#66d9ef">if</span>(include.snp){
    <span style="color:#75715e"># names(df.dat)</span>
    df.tmp <span style="color:#f92672">&lt;-</span> df.dat[df.dat<span style="color:#f92672">$</span>grp<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span> df.dat<span style="color:#f92672">$</span>snp<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>, ] 
    n.pre <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">nrow</span>(df.tmp)
    p.pre <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">sum</span>(df.tmp<span style="color:#f92672">$</span>y)<span style="color:#f92672">/</span><span style="color:#66d9ef">nrow</span>(df.tmp)
    
    df.tmp <span style="color:#f92672">&lt;-</span> df.dat[df.dat<span style="color:#f92672">$</span>grp<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> df.dat<span style="color:#f92672">$</span>snp<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>, ] 
    n.post <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">nrow</span>(df.tmp)
    p.post <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">sum</span>(df.tmp<span style="color:#f92672">$</span>y)<span style="color:#f92672">/</span><span style="color:#66d9ef">nrow</span>(df.tmp)
  }<span style="color:#66d9ef">else</span>{
    n.pre <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">nrow</span>(df.dat)
    p.pre <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">sum</span>(df.dat<span style="color:#f92672">$</span>y)<span style="color:#f92672">/</span><span style="color:#66d9ef">nrow</span>(df.dat)
    
    n.post <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">nrow</span>(df.dat)
    p.post <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">sum</span>(df.dat<span style="color:#f92672">$</span>y)<span style="color:#f92672">/</span><span style="color:#66d9ef">nrow</span>(df.dat)
  }

  
  df.simres <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(n.pre <span style="color:#f92672">=</span> n.pre,
                          n.post <span style="color:#f92672">=</span> n.post,
                          p.pre <span style="color:#f92672">=</span> p.pre,
                          p.post <span style="color:#f92672">=</span> p.post,
                          glm.prob.diff.est <span style="color:#f92672">=</span> glm.prob.diff.est,
                          glm.prob.diff.lwr <span style="color:#f92672">=</span> glm.prob.diff.lwr,
                          glm.prob.diff.upr <span style="color:#f92672">=</span> glm.prob.diff.upr,
                          glm.prob.sig.diff <span style="color:#f92672">=</span> glm.prob.sig.diff, 
                          glm.or.est <span style="color:#f92672">=</span> glm.or.est,
                          simid <span style="color:#f92672">=</span> x)

  df.simres
}</code></pre></div>

<h3 id="bringing-it-together">Bringing it together</h3>

<p>Here we incorporate the functions into a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method" target="_blank">monte carlo simulation</a>. We initialise variables and then start a loop using parallel processing (to reduce run time if multiple cores are available). The results from each simulation is stored in the <code>df.out2</code> <code>data.frame</code>. We can interogate <code>df.out2</code> to get insight into the distribution of various estimates of interest.</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Initialise variables</span>
<span style="color:#66d9ef">set.seed</span>(<span style="color:#ae81ff">354</span>)
nsim <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">999</span>
n.arm <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">650</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#75715e"># c(500, 550, 600, 650, 700)</span>
p.ctl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.174</span>
or.trt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5329</span>
or.snp <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>
boot.reps <span style="color:#f92672">=</span> <span style="color:#ae81ff">299</span>
include.snp <span style="color:#f92672">=</span> F

<span style="color:#75715e"># Run the analysis in parallel across multiple CPU cores</span>
<span style="color:#75715e"># Initiate cluster</span>
no_cores <span style="color:#f92672">&lt;-</span> detectCores() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
cl <span style="color:#f92672">&lt;-</span> makeCluster(no_cores)

<span style="color:#75715e"># Specify all the functions that are required by the sim.</span>
clusterExport(cl<span style="color:#f92672">=</span>cl, <span style="color:#66d9ef">list</span>(<span style="color:#e6db74">&#34;get.data&#34;</span>, <span style="color:#e6db74">&#34;boot.glm&#34;</span>))

l.res2 <span style="color:#f92672">&lt;-</span> parLapply(cl, 
                    <span style="color:#66d9ef">seq</span>(nsim), 
                    fun <span style="color:#f92672">=</span> sim.glm, 
                    n.arm <span style="color:#f92672">=</span> n.arm, 
                    p.ctl <span style="color:#f92672">=</span> p.ctl,
                    or.trt <span style="color:#f92672">=</span> or.trt,
                    or.snp <span style="color:#f92672">=</span> or.snp,
                    boot.reps <span style="color:#f92672">=</span> boot.reps,
                    include.snp <span style="color:#f92672">=</span> include.snp)

stopCluster(cl)


df.out2 <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.data.frame</span>(<span style="color:#66d9ef">do.call</span>(<span style="color:#66d9ef">rbind</span>, l.res2))
<span style="color:#66d9ef">mean</span>(df.out2<span style="color:#f92672">$</span>glm.prob.sig.diff)</code></pre></div></p>

<p>By setting the <code>include.snp</code> variable to <code>TRUE</code> we can run a second analysis using the same code that introduces a SNP covariate into the data generation process and the GLM specification to see what effect it has on power.</p>

<h3 id="results">Results</h3>

<p>The figure below shows the probability density for the lower bound of the difference in proportions of children born with asthma in each group. The central values for each group were 0.1 and 0.174 for the treatment and control groups respectively, aligning with the prespecified values. The proportion of the simulations where the <strong>lower bound</strong> of a 95% confidence interval for each of the estimated differences is greater than zero is 0.76, i.e. a little under 80%.</p>

<p><img src="/media/power01-diff01.png" alt="" /></p>

<blockquote>
<p>Important Note: We are looking at the difference in predicted proportions with asthma. We would get a different result if we were just looking at the significance of the odds ratio estimated from the GLM.</p>
</blockquote>

<p>The next figure shows the same plot obtained from the analysis stratified by the SNP status. In this case the proportion of the simulations where the <strong>lower bound</strong> of a 95% confidence interval for each of the estimated differences is greater than zero is 0.87 giving 87% power.</p>

<p><img src="/media/power01-diff02.png" alt="" /></p>

<h3 id="conclusion">Conclusion</h3>

<p>By introducing a patient characteristic that was related to the response we were able to increase power without adjusting the sample size assumptions.</p>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/glm">glm</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/power">power</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/logistic01-interaction/">Interpreting Interaction Terms in a GLM (Binomial family, log link) - Logistic Regression</a></li>
    
    <li><a href="/post/poisson01-interaction/">Interpreting Interaction Terms in a GLM (Poisson family, log link)</a></li>
    
    <li><a href="/post/data01-cancer/">Simulating Lung Cancer Incidence data in R</a></li>
    
    <li><a href="/post/brms01/">A brms implementation of the analysis presented in &#34;Bayesian linear mixed models using Stan: A tutorial for psychologists, linguists, and cognitive scientists&#34;</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

